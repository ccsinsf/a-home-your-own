{% extends "base.html" %}

{% block content %}

    <head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'> </script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: relative;
        top: 0;
        bottom: 0;
        width: 100%;
      }
        .marker {
      background-image: url('../static/mapbox-icon.png');
      background-size: cover;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      }
      .mapboxgl-popup {
        max-width: 200px;
      }

      .mapboxgl-popup-content {
        text-align: center;
        font-family: 'Open Sans', sans-serif;
      }
    </style>
</head>

    <h2>Given your budget, here are some cities we think you should check out! </h2>
    
<body>
        
    <div id='map' style='width: 1000px; height: 550px;'></div>
    <script>

    mapboxgl.accessToken = 'pk.eyJ1IjoiY2NzaW5zZiIsImEiOiJjanNjZHY2bm8wMTh1M3lud3U3M3lzZDhkIn0.r560K1qwtE2hq9VkHoUM5A';

    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v10',
      center: [-96, 37.8], 
      // Longitude, latitude 
      zoom: 3
    });

    let cityLocations = JSON.parse({{ cityLocations | tojson }});

    let features = [];

    for (const location of cityLocations) {
        let details = {
            type: "Feature",
            properties: { 
                "title": location.city_name, 
                "description": location.state,
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    parseFloat(location.longitude),
                    parseFloat(location.latitude)
                ]
            }
        };
    
    features.push(details)
}
    console.log(features.geometry);

    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v10',
      center: [-96, 37.8], 
      // Longitude, latitude 
      zoom: 3
    });
    
    var geojson = {
      type: 'FeatureCollection',
      features: [{
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[0].geometry.coordinates
        },
        properties: {
          title: features[0].properties.title,
          description: features[0].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[1].geometry.coordinates
        },
        properties: {
          title: features[1].properties.title,
          description: features[1].properties.description,
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[2].geometry.coordinates
        },
        properties: {
          title: features[2].properties.title,
          description: features[2].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[3].geometry.coordinates
        },
        properties: {
          title: features[3].properties.title,
          description: features[3].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[4].geometry.coordinates
        },
        properties: {
          title: features[4].properties.title,
          description: features[4].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[5].geometry.coordinates
        },
        properties: {
          title: features[5].properties.title,
          description: features[5].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[6].geometry.coordinates
        },
        properties: {
          title: features[6].properties.title,
          description: features[6].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[7].geometry.coordinates
        },
        properties: {
          title: features[7].properties.title,
          description: features[7].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[8].geometry.coordinates
        },
        properties: {
          title: features[8].properties.title,
          description: features[8].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[9].geometry.coordinates
        },
        properties: {
          title: features[9].properties.title,
          description: features[9].properties.description,
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[10].geometry.coordinates
        },
        properties: {
          title: features[10].properties.title,
          description: features[10].properties.description,
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[11].geometry.coordinates
        },
        properties: {
          title: features[11].properties.title,
          description: features[11].properties.description,
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[12].geometry.coordinates
        },
        properties: {
          title: features[12].properties.title,
          description: features[12].properties.description,
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[13].geometry.coordinates
        },
        properties: {
          title: features[13].properties.title,
          description: features[13].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[14].geometry.coordinates
        },
        properties: {
          title: features[14].properties.title,
          description: features[14].properties.description
        }
      },                                                                        
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[15].geometry.coordinates
        },
        properties: {
          title: features[15].properties.title,
          description: features[15].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[16].geometry.coordinates
        },
        properties: {
          title: features[16].properties.title,
          description: features[16].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[17].geometry.coordinates
        },
        properties: {
          title: features[17].properties.title,
          description: features[17].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[18].geometry.coordinates
        },
        properties: {
          title: features[18].properties.title,
          description: features[18].properties.description
        }
      },
      {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: features[19].geometry.coordinates
        },
        properties: {
          title: features[19].properties.title,
          description: features[19].properties.description
        }
      },                                   
      ]
    };


    console.log(features);

    //add markers to map

      geojson.features.forEach(function(marker) {

        // create a HTML element for each feature
        var el = document.createElement('div');
        el.className = 'marker';

        // make a marker for each feature and add to the map
        new mapboxgl.Marker(el)
          .setLngLat(marker.geometry.coordinates)
          new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
              .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
            
          .addTo(map);
      });

    </script>

    </body>

    {% for city in city_results %}
    <h4>

        {{city.city_name}}, {{city.state}} : Median home price is ${{city.prices[0].median_home_price}}

    </h4>

    {%endfor%}

    <img class="title-img" src="https://na.rdcpix.com/274937236/8ecb8b5c10a19ccbe1daba7bc38ec77cw-c317321xd-w685_h860_q80.jpg">
    
    <br>
    <br>
   


{% endblock %}